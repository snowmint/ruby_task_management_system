<% @user = User.find(session[:user_id]) %>
<div class="container">
  <br/>
  <h1><%= raw(t('hello_world')) %> <%= @user.username %></h1>
  
  <%= link_to raw(t('task_relate.add_task')), new_task_path %>

  <% params[:user_id] = session[:user_id] %>
  <div class="dropdown clearfix pull-right">
    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuDivider" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    <%= raw(t('sort.sort_title')) %>
        <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownMenuDivider">
    <li>
      <%= link_to( raw(t('sort.sort_create_time_desc')), root_path(:order => "created_at desc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_create_time_asc')), root_path(:order => "created_at asc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_priority_desc')), root_path(:order => "priority desc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_priority_asc')), root_path(:order => "priority asc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_status_desc')), root_path(:order => "status desc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_status_asc')), root_path(:order => "status asc", :user_id => session[:user_id])) %>
    </li>
    
    <li>
      <%= link_to( raw(t('sort.sort_start_time_desc')), root_path(:order => "start_time desc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_start_time_asc')), root_path(:order => "start_time asc", :user_id => session[:user_id])) %>
    </li>

    <li>
      <%= link_to( raw(t('sort.sort_end_time_desc')), root_path(:order => "end_time desc", :user_id => session[:user_id])) %>
    </li>
    <li>
      <%= link_to( raw(t('sort.sort_end_time_asc')), root_path(:order => "end_time asc", :user_id => session[:user_id])) %>
    </li>

    <li>
      <%= link_to(raw(t('sort.sort_id_desc')), root_path(:order => "id desc", :user_id => session[:user_id]) ) %>
    </li>
    <li>
      <%= link_to(raw(t('sort.sort_id_asc')), root_path(:order => "id asc", :user_id => session[:user_id]) ) %>
    </li>
  </ul>
    </div>
    <% @tasks = Task.where(user_id: session[:user_id]).page(params[:page]).per(5) %>
    <%
    $status_list = ["Pending", "In Progress", "Complete"]
    $priority_list = ["Urgent", "Highest", "High", "Normal", "Low", "Lowest"]
    %>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th> <% Task.human_attribute_name("tasks.user_id") %> </th>
            <th> <%= Task.human_attribute_name("tasks.task_name") %> </th>
            <th> <%= Task.human_attribute_name("tasks.content") %> </th>
            <th> <%= Task.human_attribute_name("tasks.start_time") %> </th>
            <th> <%= Task.human_attribute_name("tasks.end_time") %> </th>
            <th> <%= Task.human_attribute_name("tasks.priority") %> </th>
            <th> <%= Task.human_attribute_name("tasks.status") %> </th>
            <th> <%= Task.human_attribute_name("tasks.create_time") %> </th>
            <th> <%= Task.human_attribute_name("tasks.handle") %> </th>
          </tr>
          </thead>
          <tbody>
          <% @tasks.each do |task| %>
          <tr>
            <td><% task.user_id%></td>
            <td><%= task.task_name %></td>
            <td><%= task.content %></td>
            <td><%= task.start_time %></td>
            <td><%= task.end_time %></td>
            <td><%= $priority_list[task.priority] %></td>
            <td><%= $status_list[task.status] %></td>
            <td><%= task.created_at %></td>
            <td>
            <%= link_to raw(t('task_relate.edit_task')), edit_task_path(task) %>
            <%= link_to raw(t('task_relate.delete_task')), edit_task_path(task), method: "delete", data: { confirm: "Comfirm to delete it" } %>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
      <div sytle="margin: auto;">
        <%= paginate @tasks %>
      </div>
    </div>
  </div>
</div>